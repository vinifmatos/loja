<div class="container">
  <%= link_to t('acoes.nova', model: Promocao.name), new_admin_promocao_path, class: 'btn btn-primary' %>
  <div class="row no-gutters mt-3">
    <% @promocoes.each do |promocao| %>
      <div class="card mb-3" style="width: 100%;">
        <div class="row no-gutters">
          <div class="col-md-4">
            <%= link_to admin_promocao_path(promocao) do %>
              <%= image_tag promocao.produto.thumbnail, class: 'card-img', alt: '' %>
            <% end %>
          </div>
          <div class="col-md-7">
            <div class="card-body">
              <%= link_to admin_promocao_path(promocao) do %>
                <h5 class="card-tittle"><%= "Promoção #{promocao.id}" %></h5>
              <% end %>
              <%= "Produto: #{promocao.produto.nome}" %><br>
              <%= "Valor do produto: #{promocao.produto.preco}" %><br>
              <%= "Desconto: #{promocao.desconto}" %><br>
              <%= "Validade: #{l promocao.validade, format: :long}" %><br>
            </div>
          </div>
          <div class="col-md-1 pt-3 pr-3">
            <%= button_tag 'Publicar', type: 'button', class: "btn btn-primary btn-sm float-right btn-publicar #{'d-none' if promocao.publicada?}", data: { url: admin_publicar_promocao_path(promocao) } %>
            <%= button_tag 'Encerrar', type: 'button', class: "btn btn-primary btn-sm float-right btn-encerrar #{'d-none' unless promocao.publicada? && !promocao.encerrada?}", data: { url: admin_publicar_promocao_path(promocao) } %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
<script type='text/javascript'>
  $(document).on('turbolinks:load', function () {
    $('.btn-publicar').click(function () {
      var url = $(this).attr('data-url')
      $.post(url, function(data) {
        if (data.publicado == '1') {
          $(this).toggleClass('d-none');
          $(this).closest('.btn-encerrar').toggleClass('d-none');
        } else {
          $.alert(data.erros)
        }
      });
    });

    $('.btn-encerrar').click(function () {
      var url = $(this).attr('data-url')
      $.post(url, function(data) {
        if (data.encerrada == true) {
          $(this).toggleClass('d-none');
          $(this).closest('.btn-publicar').toggleClass('d-none');
        } else {
          $.alert(data.erros)
        }
      });
    });
  })
</script>